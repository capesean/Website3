<app-page-title title="Account"></app-page-title>

<div class="row">

    <div class="col-md-4 col-xxl-3">

        <div class="card card-primary sticky-md-top top-10px">

            <div class="card-body">
                <div class="text-center mb-5">
                    <div class="avatar avatar-xxl avatar-circle mb-5">
                        <label class="d-block cursor-pointer">
                            <span class="position-absolute bottom-0 end-0 m-0 bg-primary text-white w-30px h-30px rounded-circle d-flex align-items-center justify-content-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="14" width="14"><g><path d="M2.65,16.4a.5.5,0,0,0-.49-.13.52.52,0,0,0-.35.38L.39,23a.51.51,0,0,0,.6.6l6.36-1.42a.52.52,0,0,0,.38-.35.5.5,0,0,0-.13-.49Z" style="fill: currentColor" /><path d="M17.85,7.21l-11,11a.24.24,0,0,0,0,.35l1.77,1.77a.5.5,0,0,0,.71,0L20,9.68A.48.48,0,0,0,20,9L18.21,7.21A.25.25,0,0,0,17.85,7.21Z" style="fill: currentColor" /><path d="M16.79,5.79,15,4a.48.48,0,0,0-.7,0L3.71,14.63a.51.51,0,0,0,0,.71l1.77,1.77a.24.24,0,0,0,.35,0l11-11A.25.25,0,0,0,16.79,5.79Z" style="fill: currentColor" /><path d="M22.45,1.55a4,4,0,0,0-5.66,0l-.71.71a.51.51,0,0,0,0,.71l5,4.95a.52.52,0,0,0,.71,0l.71-.71A4,4,0,0,0,22.45,1.55Z" style="fill: currentColor" /></g></svg>
                            </span>
                            <input type="file" name="avatar" class="d-none" (click)="uploadPhoto($event)">
                        </label>

                        <span *ngIf="profile?.firstName" class="avatar-title text-bg-info-soft">{{profile.firstName.substring(0, 1)}}{{profile.lastName.substring(0, 1)}}</span>

                    </div>

                    <h3 class="mb-0">{{profile.fullName}}</h3>
                </div>

                <hr class="mb-0">

            </div>

            <ul class="mb-5 scrollspy" id="account">

                <li [class.active]="spyService.active === 'basicInformationSection'">
                    <a [routerLink]="[]"
                       fragment="basicInformationSection" class="d-flex align-items-center py-3">
                        <svg viewBox="0 0 24 24" height="14" width="14" class="me-3" xmlns="http://www.w3.org/2000/svg"><path d="M6.750 6.000 A5.250 5.250 0 1 0 17.250 6.000 A5.250 5.250 0 1 0 6.750 6.000 Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" /><path d="M2.25,23.25a9.75,9.75,0,0,1,19.5,0" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" /></svg>
                        Basic information
                    </a>
                </li>

                <li [class.active]="spyService.active === 'passwordSection'">
                    <a [routerLink]="[]"
                       fragment="passwordSection" class="d-flex align-items-center py-3">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" height="14" width="14" class="me-3"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18.75 9.75H5.25C4.42157 9.75 3.75 10.4216 3.75 11.25V21.75C3.75 22.5784 4.42157 23.25 5.25 23.25H18.75C19.5784 23.25 20.25 22.5784 20.25 21.75V11.25C20.25 10.4216 19.5784 9.75 18.75 9.75Z" /><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.75 9.75V6C6.75 4.60761 7.30312 3.27226 8.28769 2.28769C9.27226 1.30312 10.6076 0.75 12 0.75C13.3924 0.75 14.7277 1.30312 15.7123 2.28769C16.6969 3.27226 17.25 4.60761 17.25 6V9.75" /><path stroke="currentColor" stroke-width="1.5" d="M8.625 15C8.41789 15 8.25 14.8321 8.25 14.625C8.25 14.4179 8.41789 14.25 8.625 14.25" /><path stroke="currentColor" stroke-width="1.5" d="M8.625 15C8.83211 15 9 14.8321 9 14.625C9 14.4179 8.83211 14.25 8.625 14.25" /><path stroke="currentColor" stroke-width="1.5" d="M8.625 18.75C8.41789 18.75 8.25 18.5821 8.25 18.375C8.25 18.1679 8.41789 18 8.625 18" /><path stroke="currentColor" stroke-width="1.5" d="M8.625 18.75C8.83211 18.75 9 18.5821 9 18.375C9 18.1679 8.83211 18 8.625 18" /><path stroke="currentColor" stroke-width="1.5" d="M12 15C11.7929 15 11.625 14.8321 11.625 14.625C11.625 14.4179 11.7929 14.25 12 14.25" /><path stroke="currentColor" stroke-width="1.5" d="M12 15C12.2071 15 12.375 14.8321 12.375 14.625C12.375 14.4179 12.2071 14.25 12 14.25" /><g><path stroke="currentColor" stroke-width="1.5" d="M12 18.75C11.7929 18.75 11.625 18.5821 11.625 18.375C11.625 18.1679 11.7929 18 12 18" /><path stroke="currentColor" stroke-width="1.5" d="M12 18.75C12.2071 18.75 12.375 18.5821 12.375 18.375C12.375 18.1679 12.2071 18 12 18" /></g><g><path stroke="currentColor" stroke-width="1.5" d="M15.375 15C15.1679 15 15 14.8321 15 14.625C15 14.4179 15.1679 14.25 15.375 14.25" /><path stroke="currentColor" stroke-width="1.5" d="M15.375 15C15.5821 15 15.75 14.8321 15.75 14.625C15.75 14.4179 15.5821 14.25 15.375 14.25" /></g><g><path stroke="currentColor" stroke-width="1.5" d="M15.375 18.75C15.1679 18.75 15 18.5821 15 18.375C15 18.1679 15.1679 18 15.375 18" /><path stroke="currentColor" stroke-width="1.5" d="M15.375 18.75C15.5821 18.75 15.75 18.5821 15.75 18.375C15.75 18.1679 15.5821 18 15.375 18" /></g></svg>
                        Password
                    </a>
                </li>

            </ul>

        </div>

    </div>

    <div class="col">

        <div class="card card-primary scroll-mt-3" id="basicInformationSection">

            <div class="card-header">
                <div class="card-header-title">
                    <h4>Basic information</h4>
                </div>
            </div>

            <div class="card-body">

                <form id="formBasicInformation" name="formBasicInformation" (submit)="saveBasicInformation(formBasicInformation)" novalidate #formBasicInformation="ngForm" [ngClass]="{ 'was-validated': formBasicInformation.submitted }">

                    <div class="row mb-4">
                        <div class="col-lg-3">
                            <label for="fullName" class="col-form-label">First Name</label>
                        </div>

                        <div class="col-lg">

                            <input id="firstName" name="firstName" class="form-control" type="text" [(ngModel)]="profile.firstName" #firstName="ngModel" required maxlength="50" />

                            <div *ngIf="firstName.errors?.required" class="invalid-feedback">
                                First Name is required
                            </div>

                            <div *ngIf="firstName.errors?.maxlength" class="invalid-feedback">
                                First Name must be at most 50 characters long
                            </div>

                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-lg-3">
                            <label for="fullName" class="col-form-label">Last Name</label>
                        </div>

                        <div class="col-lg">

                            <input id="lastName" name="lastName" class="form-control" type="text" [(ngModel)]="profile.lastName" #lastName="ngModel" required maxlength="50" />

                            <div *ngIf="lastName.errors?.required" class="invalid-feedback">
                                Last Name is required
                            </div>

                            <div *ngIf="lastName.errors?.maxlength" class="invalid-feedback">
                                Last Name must be at most 50 characters long
                            </div>

                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-lg-3">
                            <label for="fullName" class="col-form-label">Email address</label>
                        </div>

                        <div class="col-lg">

                            <input id="email" name="email" class="form-control" type="text" [(ngModel)]="profile.email" #email="ngModel" required maxlength="256" pattern="^[^@\s]+@[^@\s]+\.[^@\s]+$" />

                            <div *ngIf="email.errors?.required" class="invalid-feedback">
                                Email is required
                            </div>

                            <div *ngIf="email.errors?.maxlength" class="invalid-feedback">
                                Email must be at most 256 characters long
                            </div>

                            <div *ngIf="email.errors?.pattern" class="invalid-feedback">
                                Email does not match the specified pattern
                            </div>

                        </div>
                    </div>

                    <div class="d-flex justify-content-end mt-5">

                        <button class="btn btn-outline-primary">Save changes</button>

                    </div>

                </form>

            </div>

        </div>

        <div class="card card-primary scroll-mt-3" id="passwordSection">

            <div class="card-header">
                <div class="card-header-title">
                    <h4>Password</h4>
                </div>
            </div>

            <div class="card-body">

                <form id="formPassword" name="formPassword" (submit)="changePassword(formPassword)" novalidate #formPassword="ngForm" [ngClass]="{ 'was-validated': formPassword.submitted }">

                    <div class="row mb-4">

                        <div class="col-lg-3">
                            <label for="currentPassword" class="col-form-label">Current password</label>
                        </div>

                        <div class="col-lg">

                            <input type="password" id="currentPassword" name="currentPassword" [(ngModel)]="changePasswordModel.currentPassword" #currentPassword="ngModel" maxlength="256" class="form-control" required placeholder="Current password" autocomplete="off" />

                            <div *ngIf="currentPassword.errors?.required" class="invalid-feedback">
                                Current password is required
                            </div>

                            <div *ngIf="currentPassword.errors?.maxlength" class="invalid-feedback">
                                Current password must be at most 256 characters long
                            </div>

                        </div>
                    </div>

                    <div class="row mb-4">

                        <div class="col-lg-3">
                            <label for="newPassword" class="col-form-label">New password</label>
                        </div>

                        <div class="col-lg">

                            <div class="input-group">
                                <input type="{{(showPasswords ? 'text' : 'password')}}" id="newPassword" name="newPassword" [(ngModel)]="changePasswordModel.newPassword"
                                       #newPassword="ngModel" [minlength]="passwordRequirements.requiredLength" maxlength="256" class="form-control" required placeholder="New password" autocomplete="off"
                                       strongPassword="3" [user_inputs]="dictionary" />
                                <button class="btn btn-secondary" (click)="showPasswords = !showPasswords" type="button"><i class="fas fa-fw" [ngClass]="{ 'fa-eye': !showPasswords, 'fa-eye-slash': showPasswords }"></i></button>
                            </div>

                            <div class="mt-3 h-15px" [ngClass]="{ 'invisible': !newPassword.value }">
                                <strength-meter [password]="newPassword.value"></strength-meter>
                            </div>

                            <div *ngIf="newPassword.errors?.required" class="invalid-feedback">
                                New password is required
                            </div>

                            <div *ngIf="newPassword.errors?.minlength" class="invalid-feedback">
                                New password must be at least [passwordRequirements.requiredLength] characters long
                            </div>

                            <div *ngIf="newPassword.errors?.maxlength" class="invalid-feedback">
                                New password must be at most 256 characters long
                            </div>

                            <div class="invalid-feedback">Please add a new password</div>

                        </div>

                        <div class="col-lg">

                            <div class="input-group">
                                <input type="{{(showPasswords ? 'text' : 'password')}}" id="confirmPassword" name="confirmPassword" [(ngModel)]="changePasswordModel.confirmPassword"
                                       #confirmPassword="ngModel" [minlength]="passwordRequirements.requiredLength" maxlength="256" class="form-control" required placeholder="New password" autocomplete="off"
                                       strongPassword="3" [user_inputs]="dictionary" />
                                <button class="btn btn-secondary" (click)="showPasswords = !showPasswords" type="button"><i class="fas fa-fw" [ngClass]="{ 'fa-eye': !showPasswords, 'fa-eye-slash': showPasswords }"></i></button>
                            </div>

                            <div class="invalid-feedback">Please confirm your new password again</div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg offset-lg-3">

                            <password-feedback *ngIf="newPassword.value && newPassword.errors?.strongPassword" [feedback]="newPassword.errors.strongPassword.feedback"></password-feedback>

                            <div class="alert bg-light mw-450px" role="alert">
                                <h4 class="mb-3">Password requirements:</h4>
                                <ul class="p-3 mb-0">
                                    <li>Minimum {{passwordRequirements.requiredLength}} characters long - the more, the better</li>
                                    <li *ngIf="passwordRequirements.requireLowercase">At least one lowercase character</li>
                                    <li *ngIf="passwordRequirements.requireUppercase">At least one uppercase character</li>
                                    <li *ngIf="passwordRequirements.requireNonAlphanumeric">At least one non-alphanumeric character</li>
                                    <li *ngIf="passwordRequirements.requireDigit">At least one digit character</li>
                                    <li *ngIf="passwordRequirements.requiredUniqueChars > 1">At least {{passwordRequirements.requiredUniqueChars+1}} unique characters</li>
                                </ul>
                            </div>

                        </div>
                    </div>

                    <div class="d-flex justify-content-end mt-5">

                        <button type="submit" class="btn btn-outline-primary">Change password</button>

                    </div>

                </form>

            </div>

        </div>

    </div>
</div>

